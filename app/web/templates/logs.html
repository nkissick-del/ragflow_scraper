{% extends "base.html" %}

{% block title %}Logs - PDF Scraper{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Logs</h1>
    <p>View application logs and scraper activity</p>
</div>

<section class="section">
    <div class="log-controls">
        <h2>Live Log Viewer</h2>
        <div class="log-filters">
            <button id="copy-logs-btn" class="btn btn-small btn-secondary" onclick="handleCopyLogs()" aria-label="Copy all logs to clipboard">
                ðŸ“‹ Copy Logs
            </button>
            <label>
                <input type="checkbox" id="auto-scroll" checked> Auto-scroll
            </label>
        </div>
    </div>

    <div class="log-container" id="log-container">
        <div class="log-viewer" role="log" aria-live="polite" aria-label="Application logs"
             hx-get="{{ url_for('metrics_logs.log_stream') }}"
             hx-trigger="load, every 2s"
             hx-swap="innerHTML">
            <p class="loading">Loading logs...</p>
        </div>
    </div>
</section>

<section class="section">
    <h2>Log Files</h2>
    <div class="log-files">
        {% for log_file in log_files %}
        <div class="log-file-item">
            <span class="log-filename">{{ log_file.name }}</span>
            <span class="log-size">{{ (log_file.stat().st_size / 1024) | round(1) }} KB</span>
            <a href="{{ url_for('metrics_logs.download_log', filename=log_file.name) }}"
               class="btn btn-small">Download</a>
        </div>
        {% else %}
        <p>No log files found.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('htmx:afterSwap', function(event) {
    if (document.getElementById('auto-scroll').checked) {
        var container = document.getElementById('log-container');
        container.scrollTop = container.scrollHeight;
    }
});

async function handleCopyLogs() {
    const logViewer = document.querySelector('.log-viewer');
    if (!logViewer) return;

    // Get text content (strips HTML tags, preserves newlines)
    const text = logViewer.innerText;

    await copyToClipboard(text);
}
</script>
{% endblock %}
