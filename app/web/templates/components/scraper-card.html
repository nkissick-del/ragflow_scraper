<div class="scraper-card"
     id="scraper-{{ scraper.name }}"
     hx-get="{{ url_for('scrapers.scraper_card', name=scraper.name) }}"
     hx-trigger="every 5s"
     hx-swap="outerHTML">
    <div class="scraper-header">
        <h3>{{ scraper.name }}</h3>
        <span class="status-badge status-{{ scraper.status }}">{{ scraper.status }}</span>
    </div>
    <p class="scraper-description">{{ scraper.description }}</p>
    <div class="scraper-stats">
        <span>Processed: {{ scraper.state.processed_count if scraper.state else 0 }}</span>
        {% if scraper.state and scraper.state.last_updated %}
        <span title="{{ scraper.state.last_updated }}">Last run: <span class="relative-time" data-timestamp="{{ scraper.state.last_updated }}">{{ scraper.state.last_updated[:10] }}</span></span>
        {% endif %}
    </div>
    <div class="scraper-actions">
        {% if scraper.status == 'running' or scraper.status == 'cancelling' %}
        <button class="btn btn-danger"
                hx-post="{{ url_for('scrapers.cancel_scraper', name=scraper.name) }}"
                hx-target="#scraper-{{ scraper.name }} .status-badge"
                hx-swap="outerHTML"
                aria-label="Cancel {{ scraper.name }} scraper"
                {% if scraper.status == 'cancelling' %}disabled{% endif %}>
            {% if scraper.status == 'cancelling' %}Cancelling...{% else %}Cancel{% endif %}
        </button>
        {% else %}
        <button class="btn btn-primary btn-with-loader"
                id="run-btn-card-{{ scraper.name }}"
                hx-post="{{ url_for('scrapers.run_scraper', name=scraper.name) }}"
                hx-target="#scraper-{{ scraper.name }}"
                hx-swap="outerHTML"
                hx-disabled-elt="this"
                hx-indicator="#run-btn-card-{{ scraper.name }}"
                aria-label="Run {{ scraper.name }} scraper">
            <span class="btn-text">Run Now</span>
            <span class="btn-loader"><span class="loading-spinner"></span></span>
        </button>
        {% endif %}
        <a href="{{ url_for('scrapers.scrapers_page') }}#scraper-{{ scraper.name }}" class="btn btn-secondary" aria-label="Configure {{ scraper.name }} scraper">Configure</a>
    </div>
</div>
